<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>PAPER</title>
    {% include "support/cssjs.html" %}
</head>
<style>
    .navbaru:hover {
        cursor: pointer;
        box-shadow: 0 .235rem .75rem rgba(0, 0, 0, .075) !important;
    }

    textarea {
        resize: none;
        overflow: hidden;
        min-height: 35px;
        font-size: 9px;
    }

    table {
        border-collapse: collapse;

    }

    td {
        padding: 0;
        margin: 0;
    }

    .headtbl {
        /*-webkit-print-color-adjust: exact !important;*/
        /*color-adjust: exact !important;*/
        background-color: #333 !important;
        color: white;
    }

    tr {
        border-top-color: coral;
    }



    #invoicenya {
        overflow: hidden;
        min-width: 21cm;
        max-width: auto;
        min-height: 29.7cm;
        max-height: auto;
    }

    
</style>
<style id="untukPrint"> 
	@page {
        margin: 0 !important;
    }

	@media screen {
	   body { font-size: 10.5pt; }
	 }
	 @media screen, print {
	   body { line-height: 1.5 }
	 }
    @media print {
        .table thead tr th {
            background-color: #03A9F4 !important;
            color: #ffffff !important;
        }

        #fabmenucustom {
            display: none;
        }
        tr.text-white{
            color: #ffffff !important;
        }

        /*body {
            -webkit-print-color-adjust: exact !important;
            color-adjust: exact !important;
        }*/
        /*.headtbl {
            /*-webkit-print-color-adjust: exact !important;
            color-adjust: exact !important;
            background-color: #333 !important;
            color: black !important;
        }*/
		html, body {
        	height: auto;
	        font-size: 10.5pt; /* changing to 10pt has no impact */
	        margin: 0;
            padding: 0;
            /*color: #ffffff;*/
            -webkit-print-color-adjust: exact !important;
            
            color-adjust: exact !important;	
	    }
        /*body {
            margin: 0;
            padding: 0;
            -webkit-print-color-adjust: exact !important;
            color-adjust: exact !important;
        }*/
    }
</style>


<body class="bg-white">
    <!-- Page content -->
    <div class="page-content container bg-white">
        <!-- Main content -->
        <div class="content-wrapper  bg-white" id="appcontent">
            {% set frm = session["konten"]["dtinv"] %}
            {% set prdk = session["konten"]["dtprdk"] %}
            <!-- Content area -->
            <div class="content bg-white">
                <!-- FLOATING ACTION BUTTOn -->
                <ul class="fab-menu fab-menu-fixed fab-menu-absolute fab-menu-bottom-right" data-fab-toggle="hover"
                    id="fabmenucustom" style="">
                    <li>
                        <a class="fab-menu-btn btn bg-danger btn-float rounded-round btn-icon">
                            <i class="fab-icon-open icon-gear"></i>
                            <i class="fab-icon-close icon-cross2"></i>
                        </a>

                        <ul class="fab-menu-inner">
                            <li>
                                <div data-fab-label="Upload Bukti Bayar">
                                    <button @click="openModalUpload"
                                        class="btn btn-light rounded-round btn-icon btn-float">
                                        <i class="icon-file-upload"></i>
                                    </button>
                                    <!-- <span class="badge bg-primary-400">5</span> -->
                                </div>
                            </li>
                            <li>
                                <div data-fab-label="Print">
                                    <button onclick="window.print()"
                                        class="btn btn-light rounded-round btn-icon btn-float">
                                        <i class="icon-printer2"></i>
                                    </button>
                                </div>
                            </li>
                            <li>
                                <div data-fab-label="Set Margin">
                                    <button onclick="setMargin()"
                                        class="btn btn-light rounded-round btn-icon btn-float">
                                        <i class="icon-fold"></i>
                                    </button>
                                </div>
                            </li>
                            <li>
                                <div data-fab-label="Send Email">
                                    <button
                                        onclick="sendEmail('{{frm['noinv']}}', '{{frm['bulan']}}', '{{frm['tahun']}}')"
                                        class="btn btn-light rounded-round btn-icon btn-float">
                                        <i class="icon-envelop"></i>
                                    </button>
                                    <!-- <span class="badge bg-primary-400">5</span> -->
                                </div>
                            </li>
                            <li>
                                <div data-fab-label="Info">
                                    <button @click="openModalInfo"
                                        class="btn btn-light rounded-round btn-icon btn-float">
                                        <i class="icon-info3"></i>
                                    </button>
                                    <!-- <span class="badge bg-primary-400">5</span> -->
                                </div>
                            </li>
                        </ul>
                    </li>
                </ul>
                <!-- Basic card -->
                <div class="card border-0 d-flex justify-content-center">
                    <!-- <div class="card-header header-elements-inline">
                        <h5 class="card-title">Tambah Invoice</b></h5>
                        <div class="header-elements">
                            <div class="list-icons">
                                <a class="list-icons-item" data-action="collapse"></a>
                                <a class="list-icons-item" data-action="reload"></a>
                                <a class="list-icons-item" data-action="remove"></a>
                            </div>
                        </div>
                    </div> -->
                    <div class="card-body" id="invoicenya">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="row">
                                    <div class="col-md-5">
                                        <div class="" width="100%"><img
                                                src="{{url_for('static', filename='global_assets/images/mgplogo.png')}}"
                                                width="140" height="140" class="rounded-circle">
                                        </div>
                                    </div>
                                    <div class="col-md-7 text-right">

                                        <div class="panel-body">
                                            <div class="col-xs-12 text-right">
                                                <h1 class="text-blue">Invoice</h1>
                                            </div>
                                            <div class="col-xs-12">
                                                <div class="row">
                                                    <div class="col-md-8 font-weight-bold">
                                                        Referensi
                                                    </div>
                                                    <div class="col-md-4 text-right">
                                                        {{frm["noinv2"]}}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-xs-12">
                                                <div class="row">
                                                    <div class="col-md-8 font-weight-bold">
                                                        Tanggal
                                                    </div>
                                                    <div class="col-md-4 text-right">
                                                        {{frm["tglcreate"]}}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-xs-12">
                                                <div class="row">
                                                    <div class="col-md-8 font-weight-bold">
                                                        Tgl Jatuh Tempo
                                                    </div>
                                                    <div class="col-md-4 text-right">
                                                        {{frm["tgljatuhtempo"]}}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-xs-12">
                                                <div class="row">
                                                    <div class="col-md-8 font-weight-bold">
                                                        No. NPWP
                                                    </div>
                                                    <div class="col-md-4 text-right">
                                                        {{nonpwpmg}}
                                                    </div>
                                                </div>
                                            </div>
                                            {% set stsbayar, textcolor = "Unpaid","warning" %}
                                            {% if frm["stsinv"] == 1 %}
                                            {% set stsbayar, textcolor = "Unpaid","warning" %}
                                            {% elif frm["stsinv"] == 2 %}
                                            {% set stsbayar, textcolor = "Jatuh Tempo","danger" %}
                                            {% elif frm["stsinv"] == 0 %}
                                            {% set stsbayar, textcolor = "Lunas","success" %}
                                            {% elif frm["stsinv"] == 9 %}
                                            {% set stsbayar, textcolor = "Sudah Transfer","primary"%}
                                            {% endif %}
                                            <div class="col-xs-12">
                                                <div class="row">
                                                    <div class="col-md-8 font-weight-bold">
                                                        Status Invoice
                                                    </div>
                                                    <div
                                                        class="col-md-4 text-right text-{{textcolor}} font-weight-bold">
                                                        {{stsbayar}}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>

                        </div>
                        <div class="row mt-5">
                            <!---->
                            <div class="col-md-6">
                                <div class="panel-body">
                                    <h3 class="font-weight-semibold">Info Perusahaan</h3>
                                    <hr class="separator border-1">
                                    <h4 class="text-blue">Mitrasoft Global Perdana</h4>
                                    <span>Alamat:</span>
                                    Komp. Pura Bojonggede
                                    <br>Jl. Madura I Blok A2 No. 34 Kel. Tajurhalang, Kec. Tajurhalang Kab. Bogor
                                    <br>Jawa Barat 16320
                                    <br>Indonesia
                                    <br>
                                    <span>Telp:</span>
                                    081717787823
                                    <br>
                                    <span>Email:</span>
                                    admin@mglobalperdana.com
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="panel-body">
                                    <h3 class="font-weight-semibold">Tagihan Untuk</h3>
                                    <hr class="separator border-1">
                                    <h4 class="text-blue">{{frm["nmclient"]}}</h4>
                                    <span>Alamat:</span>
                                    {{frm["alamat1"]}}
                                    <br>{{frm["alamat2"]}}&nbsp;{{frm["kabkot"]}}
                                    <br>{{frm["prov"]}}&nbsp;{{frm["poscode"]}}
                                    <br>{{frm["negara"]}}
                                    <br>Telp:&nbsp;{{frm["notlp"]}}
                                    <br>Email:&nbsp;{{frm["email"]}}
                                    <br>No NPWP:&nbsp;{{frm["nonpwp"]}}
                                </div>
                            </div>
                        </div>

                        <div class="row mt-5">
                            <div class="col-md-12">
                                <table class="table">
                                    <thead>
                                        <!-- <tr class="headtbl"> -->
                                        <tr class="bg-primary text-white">
                                            <th style="width:20%">Produk</th>
                                            <th style="width:20%">Deskripsi</th>
                                            <th class="text-center" style="width:5%">Kuantitas</th>
                                            <th class="text-right" style="width:15%">Harga</th>
                                            <th class="text-right d-none" style="width:10%">Diskon</th>
                                            <th class="text-center d-none" style="width:10%">Pajak</th>
                                            <th class="text-right" style="width:15%">Jumlah</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for x in prdk %}
                                        <tr class="border-bottom-danger table-border-solid">
                                            <td>{{x["nmproduk"]|safe}}</td>
                                            <td>{{x["deskripsi"]|safe}}</td>
                                            <td class="text-center">{{x["qty"]}}</td>
                                            <td class="text-right">{{rupiah_format(x["harga"]|int, with_prefix=True)}}
                                            </td>
                                            <td class="text-right d-none"><span> 0%</span></td>
                                            <td class="text-center d-none"><span> -</span></td>
                                            <td class="text-right">{{rupiah_format(x["total"]|int, with_prefix=True)}}
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-md-6"></div>
                            <div class="col-md-6">
                                <div class="table-responsive">
                                    <table class="table" style="">
                                        <tbody class="">
                                            <tr class="">
                                                <th class="" style="width:50%">Subtotal</th>
                                                <td class="text-right"><span class=""
                                                        id="subTotal">{{rupiah_format((frm["totalharga"]|int) + (frm["diskontmbh"]|int)|int, with_prefix=True)}}</span>
                                                </td>
                                            </tr>
                                            <tr class="">
                                                <th class="d-none">Total Diskon</th>
                                                <td class="text-right d-none"><span class="" id="taxTotal">Rp
                                                        0.00</span></td>
                                            </tr>
                                            <tr class="">
                                                <th class="">Diskon Tambahan</th>
                                                <td class="text-right"><span class=""
                                                        id="taxTotal">{{ rupiah_format(frm["diskontmbh"]|int, with_prefix=True) }}</span>
                                                </td>
                                            </tr>
                                            <tr class="d-none">
                                                <th class="">Pajak</th>
                                                <td class="text-right"><span class="" id="taxTotal">Rp 0.00</span></td>
                                            </tr>
                                            <tr class="d-none">
                                                <th class="">Total</th>
                                                <td class="text-right"><span
                                                        class="grandTotal">{{frm["totalharga"]}}</span></td>
                                            </tr>
                                            <tr class="d-none">
                                                <th class="">Lunas</th>
                                                <td class="text-right"><span class="grandTotal">Rp 0</span></td>
                                            </tr>
                                            <tr class="">
                                                <th class="">Jumlah Tertagih :</th>
                                                <td class="text-right"><span
                                                        class="grandTotal">{{ rupiah_format(frm["totalharga"]|int, with_prefix=True) }}</span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div id="bawahnya" class="row" style="margin-top: 200px;">
                            <div class="col-md-6">
                                <div class="panel-body">
                                    <div class="notes" style="visibility: hidden;">
                                        <h5>Keterangan</h5>
                                        <div class="">
                                            <p></p>
                                        </div>
                                    </div>
                                    <div class="notes">
                                        <h4 class="font-weight-semibold">Keterangan</h4>
                                        <!-- <hr class="separator border-1"> -->
                                        <hr class="separator border-1">
                                        <div class="">
                                            <p>{{frm["ket"]|safe}}</p>
                                        </div>
                                    </div>
                                    <!-- <div class="terms">
                                        <h4 class="invoice_title_h4">Syarat dan Ketentuan</h4>
                                        <hr class="separator">
                                        <div class=""></div>
                                    </div> -->
                                </div>
                            </div>
                            <!---->
                            <div class="col-md-6 text-center">
                                <h6 class="text-center">{{frm["tglsign"]}}</h6>
                                <div class="mt-4">
                                    <!-- <img class="img-fluid rounded-circle" src="../../../../global_assets/images/placeholders/placeholder.jpg" width="170"
                                        height="170" alt=""> -->
                                    <img class="img-fluid"
                                        src="{{url_for('static', filename='global_assets/images/signature.png')}}"
                                        width="200" height="100" style="visibility: hidden;">
                                </div>
                                <h5 class="mt-2 text-center font-weight-semibold">{{frm["nmsign"]|safe}}</h5>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Small modal -->
                <div id="modalnya" class="modal" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Upload Bukti Bayar</h5>
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                            </div>

                            <div class="modal-body">
                                <h6 class="font-weight-semibold">Silahkan Upload Bukti Bayar</h6>
                                <div class="form-group row">
                                    <!-- <label class="col-lg-2 col-form-label font-weight-semibold">Single file
                	                                        upload:</label> -->
                                    <div class="col-lg">
                                        <input type="file" class="file-input" data-fouc>
                                    </div>
                                </div>
                                <!-- <img class="img-fluid"
                	                                    src="{{url_for('static', filename='global_assets/images/signature.png')}}"
                	                                    width="200" height="auto"> -->
                            </div>

                            <div class="modal-footer">
                                <!-- <button type="button" class="btn btn-link" data-dismiss="modal">Close</button> -->
                                <!-- <button type="button" class="btn bg-primary">Upload</button> -->
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Small modal -->
                <div id="modalnya" class="modal" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Upload Bukti Bayar</h5>
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                            </div>

                            <div class="modal-body">
                                <h6 class="font-weight-semibold">Silahkan Upload Bukti Bayar</h6>
                                <div class="form-group row">
                                    <!-- <label class="col-lg-2 col-form-label font-weight-semibold">Single file
                                                        upload:</label> -->
                                    <div class="col-lg">
                                        <input type="file" class="file-input" data-fouc>
                                    </div>
                                </div>
                                <!-- <img class="img-fluid"
                                                    src="{{url_for('static', filename='global_assets/images/signature.png')}}"
                                                    width="200" height="auto"> -->
                            </div>

                            <div class="modal-footer">
                                <!-- <button type="button" class="btn btn-link" data-dismiss="modal">Close</button> -->
                                <!-- <button type="button" class="btn bg-primary">Upload</button> -->
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /basic card -->
                <div id="modalnya2" class="modal" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Bukti Bayar</h5>
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                            </div>

                            <div class="modal-body">
                                <!-- <p class="font-weight-semibold">Jika Gambar Belum Muncul Silahkan Reload dengan cara
                                                    Tekan CTRL+F5 pada Keyboard</p> -->
                                {% set pth = "buktibayar/"+frm.buktibayar if not frm.buktibayar == None else '' %}
                                <img id="imgnya" class="img-fluid" src="{{url_for('static', filename=pth)}}"
                                    alt="Belum ada Bukti Transfer">
                            </div>

                            <div class="modal-footer">
                                <!-- <button type="button" class="btn btn-link" data-dismiss="modal">Close</button> -->
                                <!-- <button type="button" class="btn bg-primary">Upload</button> -->
                            </div>
                        </div>
                    </div>
                </div>
                <div id="modalSetupPrint" class="modal fade" tabindex="-1">
					<div class="modal-dialog modal-xs">
						<div class="modal-content">
							<div class="modal-header">
								<h5 class="modal-title">Setup Print</h5>
								<button type="button" class="close" data-dismiss="modal">&times;</button>
							</div>

							<div class="modal-body">
								<div class="row">
									<div class="col-md-6">
										<input id="setInLeft" type="number" class="form-control" value="0">
										<span class="text-muted">Left</span>
									</div>
									<div class="col-md-6">
										<input id="setInTop" type="number" class="form-control" value="0">
										<span class="text-muted">Top</span>
									</div>
								</div>
								<div class="row mt-2">
									<div class="col-md-6">
										<input id="setInRight" type="number" class="form-control" value="0">
										<span class="text-muted">Right</span>
									</div>
									<div class="col-md-6">
										<input id="setInBottom" type="number" class="form-control" value="0">
										<span class="text-muted">Bottom</span>
									</div>
								</div>
								<div class="row mt-2">
									<div class="col-md-6">
										<input id="setInLength" type="number" class="form-control" value="0">
										<span class="text-muted">TTD From Content</span>
									</div>
									<div class="col-md-6">
										<input id="tmpsetInFont" type="hidden" class="form-control" value="">
										<input id="setInFont" type="number" class="form-control" value="10.5">
										<span class="text-muted">Font Size</span>
									</div>
								</div>
								<div class="row mt-5">
									<div class="col-md-12">
										<button onclick="setMarginBtn()" class="btn btn-primary btn-block">Change</button>
									</div>
								</div>
							</div>

							<div class="modal-footer">
								<!-- <button type="button" class="btn btn-link" data-dismiss="modal">Close</button> -->
								<!-- <button type="button" id="btnsend" onclick="sendMail()" class="btn bg-primary">Send</button> -->
							</div>
						</div>
					</div>
				</div>

            </div>
            <!-- /content area -->

        </div>
        <!-- /main content -->
    </div>
    <script>
        function setMargin() {
        	//let a = prompt("ukuran margin?", $("#bawahnya").css("margin-top").replace("px", ""))

        	$("#setInLength").val($("#bawahnya").css("margin-top").replace("px", ""))
        	
        	$("#setInLeft").val($("#invoicenya").css("margin-left").replace("px", ""))
        	$("#setInTop").val($("#invoicenya").css("margin-top").replace("px", ""))
        	$("#setInRight").val($("#invoicenya").css("margin-right").replace("px", ""))
        	$("#setInBottom").val($("#invoicenya").css("margin-bottom").replace("px", ""))
        	$("#setInFont").val($("#setInFont").val())

            $("#modalSetupPrint").modal("show")
            //window.print()
        }
        function setMarginBtn(){
        	$("#bawahnya").css("margin-top", `${$("#setInLength").val()}px`)
            $("#invoicenya").css("margin-left", `${$("#setInLeft").val()}px`)
            $("#invoicenya").css("margin-top", `${$("#setInTop").val()}px`)
            $("#invoicenya").css("margin-right", `${$("#setInRight").val()}px`)
            $("#invoicenya").css("margin-bottom", `${$("#setInBottom").val()}px`)
            $("style#untukPrint").text(`
            	@page {
			        margin: 0 !important;
			    }

				@media screen {
				   body { font-size: ${$("#setInFont").val()}pt; }
				 }
				 @media screen, print {
				   body { line-height: 1.5 }
				 }
			    @media print {
			        .table thead tr th {
			            background-color: #03A9F4 !important;
			            color: #ffffff !important;
			        }

			        #fabmenucustom {
			            display: none;
			        }

			        /*body {
			            -webkit-print-color-adjust: exact !important;
			            color-adjust: exact !important;
			        }*/
			        /*.headtbl {
			            /*-webkit-print-color-adjust: exact !important;
			            color-adjust: exact !important;
			            background-color: #333 !important;
			            color: black !important;
			        }*/
					html, body {
			        	height: auto;
				        font-size: ${$("#setInFont").val()}pt; /* changing to 10pt has no impact */
				        margin: 0;
			            padding: 0;
			            -webkit-print-color-adjust: exact !important;
			            
			            color-adjust: exact !important;	
				    }
			        /*body {
			            margin: 0;
			            padding: 0;
			            -webkit-print-color-adjust: exact !important;
			            color-adjust: exact !important;
			        }*/
			    }

                tr.text-white{
                            color: #ffffff !important;
                        }
            	`)
        }
        function sendEmail(no, bln, thn) {
            let jsn = {
                "noinv": no,
                "bulan": bln,
                "tahun": thn,
                "edit": true,
            }
            $.post("setparaminv", jsn).done((data) => {
                //console.log(data)
                window.open("?m=showinvemail", '_blank')
            }).fail((xhr, msg, txt) => {
                console.log(xhr, msg, txt)
            })
            //console.log(noinv, tahun, bulan)
        }
        function auto_grow(element) {
            element.style.height = "5px";
            element.style.height = (element.scrollHeight) + "px";
        }
        $(window).on('scroll', function () {
            if ($(window).scrollTop() + $(window).height() > $(document).height() - 40) {
                $('.fab-menu-bottom-left, .fab-menu-bottom-right').addClass('reached-bottom');
            }
            else {
                $('.fab-menu-bottom-left, .fab-menu-bottom-right').removeClass('reached-bottom');
            }
        });
        let swalInit = swal.mixin({
            buttonsStyling: false,
            confirmButtonClass: 'btn btn-primary',
            cancelButtonClass: 'btn btn-light'
        });
        let appcontent = new Vue({
            el: '#appcontent',
            delimiters: ['((', '))'],
            data: {
                tglnow: new Date(),
                tblidx: '123',
                atas: {
                    'noinv': '',
                    'tglinvawal': '',
                    'tglinvakhir': '',
                    'noinv': '',
                    'idmitra': '',
                },
                bawah: {
                    'subtotal': '0',
                    'totaldisc': '0',
                    'tambahdisc': '0',
                    'pajak': '0',
                    'totalall': '0',
                },
                dtmitra: {
                    "uuid": "",
                    "name": "",
                    "address1": "",
                    "address2": "",
                    "email": "",
                    "city": "",
                    "state": "",
                    "country": "",
                    "phone": "",
                    "postal_code": "",
                },
                cbmitra: [
                    {
                        "uuid": "598fd098-8dd4-4fb5-a091-e03898bdd066",
                        "category_id": null,
                        "number": "TEST01",
                        "name": "Rayhan",
                        "partner_company_type": "cv",
                        "email": "rayhanvarian@gmail.com",
                        "address1": null,
                        "address2": null,
                        "city": null,
                        "state": null,
                        "postal_code": "",
                        "country": null,
                        "phone": "08976975253",
                        "mobile": "",
                        "website": null,
                        "notes": "",
                        "data_status": "show",
                        "deleted_at": null,
                        "created_at": "2020-06-22 14:49:53",
                        "updated_at": "2020-06-22 14:49:53",
                        "company_id": "aee8e974-68e9-4310-a339-827a86feb3ca",
                        "increment_num": 0,
                        "type": "Client",
                        "max_credit_limit": 0,
                        "payment_term": 0,
                        "virtual_account": null
                    },
                    {
                        "uuid": "5d694909-6a03-40e0-aaad-cefd886b24f2",
                        "category_id": null,
                        "number": "BMT034",
                        "name": "BMT Karisma",
                        "partner_company_type": "pt",
                        "email": "Bmt_Karisma@yahoo.com",
                        "address1": "Jl. Jeruk Raya Sanden - Magelang",
                        "address2": null,
                        "city": "Magelang",
                        "state": "Jawa Tengah",
                        "postal_code": "",
                        "country": "Indonesia",
                        "phone": "085643333347",
                        "mobile": "",
                        "website": null,
                        "notes": "",
                        "data_status": "show",
                        "deleted_at": null,
                        "created_at": "2020-06-17 10:11:52",
                        "updated_at": "2020-06-17 10:11:52",
                        "company_id": "aee8e974-68e9-4310-a339-827a86feb3ca",
                        "increment_num": 0,
                        "type": "Client",
                        "max_credit_limit": 0,
                        "payment_term": 0,
                        "virtual_account": null
                    },
                    {
                        "uuid": "6948fc25-acb8-4f6d-82ce-244c19abf989",
                        "category_id": null,
                        "number": "BMT033",
                        "name": "BMT Melati",
                        "partner_company_type": "pt",
                        "email": "bmtmelati@gmail.com",
                        "address1": "Jl. Raya Purworejo KM 14 Sapuran, Wonosobo",
                        "address2": null,
                        "city": "Wonosobo",
                        "state": "Jawa Tengah",
                        "postal_code": "",
                        "country": "Indonesia",
                        "phone": "085328970114",
                        "mobile": "",
                        "website": null,
                        "notes": "",
                        "data_status": "show",
                        "deleted_at": null,
                        "created_at": "2020-06-17 10:02:36",
                        "updated_at": "2020-06-17 10:02:36",
                        "company_id": "aee8e974-68e9-4310-a339-827a86feb3ca",
                        "increment_num": 0,
                        "type": "Client",
                        "max_credit_limit": 0,
                        "payment_term": 0,
                        "virtual_account": null
                    },
                    {
                        "uuid": "ed8ac032-6321-44d6-99ec-0d1fc8f5225a",
                        "category_id": null,
                        "number": "BMT032",
                        "name": "BMT Al-Falah",
                        "partner_company_type": "pt",
                        "email": "ga.alfalah@gmail.com",
                        "address1": "Jl. Sultan Agung No. 9 Sumber, Cirebon, Jawa Barat",
                        "address2": null,
                        "city": null,
                        "state": "Jawa Barat",
                        "postal_code": "",
                        "country": "Indonesia",
                        "phone": "0000",
                        "mobile": "",
                        "website": null,
                        "notes": "",
                        "data_status": "show",
                        "deleted_at": null,
                        "created_at": "2020-06-17 09:43:16",
                        "updated_at": "2020-06-17 09:43:16",
                        "company_id": "aee8e974-68e9-4310-a339-827a86feb3ca",
                        "increment_num": 0,
                        "type": "Client",
                        "max_credit_limit": 0,
                        "payment_term": 0,
                        "virtual_account": null
                    },
                    {
                        "uuid": "b2bfe123-845c-4270-ae78-9aa5eef6e13f",
                        "category_id": null,
                        "number": "BPRS087",
                        "name": "BPRS Al- Mabrur",
                        "partner_company_type": "pt",
                        "email": "bprsalmabrur@ymail.com",
                        "address1": "Jl. Klaten - solo KM 4 Potrowangsan, Karanganom, Klaten",
                        "address2": null,
                        "city": "Klaten",
                        "state": null,
                        "postal_code": "",
                        "country": "Indonesia",
                        "phone": "0272-330697",
                        "mobile": "",
                        "website": null,
                        "notes": "",
                        "data_status": "show",
                        "deleted_at": null,
                        "created_at": "2020-06-17 09:36:37",
                        "updated_at": "2020-06-17 13:25:45",
                        "company_id": "aee8e974-68e9-4310-a339-827a86feb3ca",
                        "increment_num": 0,
                        "type": "Client",
                        "max_credit_limit": 0,
                        "payment_term": 0,
                        "virtual_account": null
                    },
                    {
                        "uuid": "b619b70e-af91-4ab5-a049-a5bbf105b45e",
                        "category_id": null,
                        "number": "BMT030",
                        "name": "PT BMT ARTHA AMANAH SANDEN",
                        "partner_company_type": "pt",
                        "email": "abitora@yahoo.co.id",
                        "address1": "Jl. Sanden - Srigading",
                        "address2": "Senden, Gadingsari, BANTUL",
                        "city": "Daerah Istimewa Yogyakarta",
                        "state": null,
                        "postal_code": null,
                        "country": null,
                        "phone": "+62 851-0084-3929",
                        "mobile": "+62 851-0084-3929",
                        "website": null,
                        "notes": null,
                        "data_status": "show",
                        "deleted_at": null,
                        "created_at": "2020-05-20 11:42:17",
                        "updated_at": "2020-05-20 11:42:17",
                        "company_id": "aee8e974-68e9-4310-a339-827a86feb3ca",
                        "increment_num": 0,
                        "type": "Client",
                        "max_credit_limit": null,
                        "payment_term": 0,
                        "virtual_account": null
                    },
                    {
                        "uuid": "d4e56796-e3b2-438a-8247-d8ed4fa83fb6",
                        "category_id": null,
                        "number": "BMT029",
                        "name": "BMT Insan Mandiri",
                        "partner_company_type": "lainnya",
                        "email": "bmtinsanmandiri@gmail.com",
                        "address1": "Gemolong",
                        "address2": null,
                        "city": "Sragen",
                        "state": null,
                        "postal_code": null,
                        "country": null,
                        "phone": "000",
                        "mobile": null,
                        "website": null,
                        "notes": null,
                        "data_status": "show",
                        "deleted_at": null,
                        "created_at": "2020-05-13 14:36:23",
                        "updated_at": "2020-05-13 14:36:23",
                        "company_id": "aee8e974-68e9-4310-a339-827a86feb3ca",
                        "increment_num": 0,
                        "type": "Client",
                        "max_credit_limit": null,
                        "payment_term": 0,
                        "virtual_account": null
                    },
                    {
                        "uuid": "9302a283-7a44-4307-bfc7-3df138ec411e",
                        "category_id": null,
                        "number": "UNIV001",
                        "name": "Universitas Bhayangkara",
                        "partner_company_type": "lainnya",
                        "email": "alimuhdlor@yahoo.com",
                        "address1": "Jl. Ahmad Yani No. 14",
                        "address2": null,
                        "city": "Surabaya",
                        "state": "Jawa Timur",
                        "postal_code": null,
                        "country": null,
                        "phone": "00000000000",
                        "mobile": null,
                        "website": null,
                        "notes": null,
                        "data_status": "show",
                        "deleted_at": null,
                        "created_at": "2020-05-13 14:26:54",
                        "updated_at": "2020-05-13 14:26:54",
                        "company_id": "aee8e974-68e9-4310-a339-827a86feb3ca",
                        "increment_num": 0,
                        "type": "Client",
                        "max_credit_limit": null,
                        "payment_term": 0,
                        "virtual_account": null
                    }
                ],
                info: {
                    company: {
                        'alamat1': '',
                        'alamat2': '',
                        'kotakab': '',
                        'provinsi': '',
                        'kdpos': '',
                        'indonesia': '',
                    },
                    mitra: {
                        'alamat1': '',
                        'alamat2': '',
                        'kotakab': '',
                        'provinsi': '',
                        'kdpos': '',
                        'indonesia': '',
                    }
                },
                tbl: []
            },
            beforeMount() {

            },
            mounted() {
                $("#imgnya").attr('src', $("#imgnya").attr("src") + '?' + (new Date()).getTime());
                $('.datepicker').datepicker({
                    isRTL: $('html').attr('dir') == 'rtl' ? true : false
                });
                $('#range-from').datepicker({
                    //defaultDate: '+1w',
                    numberOfMonths: 2,
                    onClose: function (selectedDate) {
                        $('#range-to').datepicker('option', 'minDate', selectedDate);
                    },
                    isRTL: $('html').attr('dir') == 'rtl' ? true : false
                }).datepicker("setDate", new Date());

                // To
                $('#range-to').datepicker({
                    //defaultDate: '+1w',
                    numberOfMonths: 2,
                    onClose: function (selectedDate) {
                        $('#range-from').datepicker('option', 'maxDate', selectedDate);
                    },
                    isRTL: $('html').attr('dir') == 'rtl' ? true : false
                });
                // Modal template
                let modalTemplate = '<div class="modal-dialog modal-lg" role="document">\n' +
                    '  <div class="modal-content">\n' +
                    '    <div class="modal-header align-items-center">\n' +
                    '      <h6 class="modal-title">{heading} <small><span class="kv-zoom-title"></span></small></h6>\n' +
                    '      <div class="kv-zoom-actions btn-group">{toggleheader}{fullscreen}{borderless}{close}</div>\n' +
                    '    </div>\n' +
                    '    <div class="modal-body">\n' +
                    '      <div class="floating-buttons btn-group"></div>\n' +
                    '      <div class="kv-zoom-body file-zoom-content"></div>\n' + '{prev} {next}\n' +
                    '    </div>\n' +
                    '  </div>\n' +
                    '</div>\n';

                // Buttons inside zoom modal
                let previewZoomButtonClasses = {
                    toggleheader: 'btn btn-light btn-icon btn-header-toggle btn-sm',
                    fullscreen: 'btn btn-light btn-icon btn-sm',
                    borderless: 'btn btn-light btn-icon btn-sm',
                    close: 'btn btn-light btn-icon btn-sm'
                };

                // Icons inside zoom modal classes
                let previewZoomButtonIcons = {
                    prev: '<i class="icon-arrow-left32"></i>',
                    next: '<i class="icon-arrow-right32"></i>',
                    toggleheader: '<i class="icon-menu-open"></i>',
                    fullscreen: '<i class="icon-screen-full"></i>',
                    borderless: '<i class="icon-alignment-unalign"></i>',
                    close: '<i class="icon-cross2 font-size-base"></i>'
                };

                // File actions
                let fileActionSettings = {
                    zoomClass: '',
                    zoomIcon: '<i class="icon-zoomin3"></i>',
                    dragClass: 'p-2',
                    dragIcon: '<i class="icon-three-bars"></i>',
                    removeClass: '',
                    removeErrorClass: 'text-danger',
                    removeIcon: '<i class="icon-bin"></i>',
                    indicatorNew: '<i class="icon-file-plus text-success"></i>',
                    indicatorSuccess: '<i class="icon-checkmark3 file-icon-large text-success"></i>',
                    indicatorError: '<i class="icon-cross2 text-danger"></i>',
                    indicatorLoading: '<i class="icon-spinner2 spinner text-muted"></i>'
                };
                $('.file-input').fileinput({
                    browseLabel: 'Browse',
                    uploadUrl: "/uploadbuktibayar", // server upload action
                    uploadAsync: true,
                    maxFileCount: 1,
                    initialPreview: [],
                    allowedFileExtensions: ["jpg", "jpeg", "gif", "png"],
                    browseIcon: '<i class="icon-file-plus mr-2"></i>',
                    uploadIcon: '<i class="icon-file-upload2 mr-2"></i>',
                    removeIcon: '<i class="icon-cross2 font-size-base mr-2"></i>',
                    fileActionSettings: {
                        removeIcon: '<i class="icon-bin"></i>',
                        uploadIcon: '<i class="icon-upload"></i>',
                        uploadClass: '',
                        zoomIcon: '<i class="icon-zoomin3"></i>',
                        zoomClass: '',
                        indicatorNew: '<i class="icon-file-plus text-success"></i>',
                        indicatorSuccess: '<i class="icon-checkmark3 file-icon-large text-success"></i>',
                        indicatorError: '<i class="icon-cross2 text-danger"></i>',
                        indicatorLoading: '<i class="icon-spinner2 spinner text-muted"></i>',
                    },
                    layoutTemplates: {
                        icon: '<i class="icon-file-check"></i>',
                        modal: modalTemplate
                    },
                    initialCaption: 'No file selected',
                    previewZoomButtonClasses: previewZoomButtonClasses,
                    previewZoomButtonIcons: previewZoomButtonIcons
                }).on('fileuploaded', (event, previewId, index, fileId) => {

                    let jsn = {
                        "noinv": '{{frm.noinv}}',
                        "bulan": '{{frm.bulan}}',
                        "tahun": '{{frm.tahun}}',
                        "edit": true,
                    }
                    $.post("setparaminv", jsn).done((data) => {
                        document.location.reload(true);
                    }).fail((xhr, msg, txt) => {
                        console.log(xhr, msg, txt)
                    })
                    //document.location.reload(true); document.location = 'uploadbuktibayar?key=' + key
                    //window.URL.revokeObjectURL()

                })
                //CKEDITOR.replace('ketbawah', {
                //    //height: 400,
                //    //extraPlugins: 'forms'
                //});
                //CKEDITOR.editorconfig = function (config) {
                //    config.toolbarGroups = [
                //        //{ name: 'document', groups: ['mode', 'document', 'doctools'] },
                //        //{ name: 'clipboard', groups: ['clipboard', 'undo'] },
                //        //{ name: 'editing', groups: ['find', 'selection', 'spellchecker', 'editing'] },
                //        //{ name: 'forms', groups: ['forms'] },
                //        //{ name: 'basicstyles', groups: ['basicstyles', 'cleanup'] },
                //        //{ name: 'paragraph', groups: ['list', 'indent', 'blocks', 'align', 'bidi', 'paragraph'] },
                //        //{ name: 'links', groups: ['links'] },
                //        //{ name: 'insert', groups: ['insert'] },
                //        //{ name: 'styles', groups: ['styles'] },
                //        //{ name: 'colors', groups: ['colors'] },
                //        //{ name: 'tools', groups: ['tools'] },
                //        //{ name: 'others', groups: ['others'] },
                //        //{ name: 'about', groups: ['about'] }
                //    ];
                //
                //    config.removeButtons = 'About,Maximize,TextColor,Styles,Image,Flash,Table,HorizontalRule,Smiley,SpecialChar,PageBreak,Iframe,BidiLtr,BidiRtl,Language,Blockquote,CreateDiv,CopyFormatting,RemoveFormat,Format,Font,FontSize,ShowBlocks,BGColor,Form,Checkbox,Radio,TextField,Textarea,Select,Button,ImageButton,HiddenField,Unlink,Anchor,Link,Source,Save,NewPage,Preview,Print,Templates,Find,Replace,SelectAll';
                //}
                //CKEDITOR.replace('syaratbawah', {
                //    //height: 400,
                //    //extraPlugins: 'forms'
                //
                //});
                this.addrowtbl()
            },
            watch: {
                'bawah.tambahdisc': {
                    handler: function (newVal) {
                        function formatRupiah(angka, prefix) {
                            var number_string = angka.toString().replace(/[^,\d]/g, "").toString(),
                                split = number_string.split(","),
                                sisa = split[0].length % 3,
                                rupiah = split[0].substr(0, sisa),
                                ribuan = split[0].substr(sisa).match(/\d{3}/gi);
                            if (ribuan) {
                                separator = sisa ? "." : "";
                                rupiah += separator + ribuan.join(".");
                            }

                            rupiah = split[1] != undefined ? rupiah + "," + split[1] : rupiah;
                            return prefix == undefined ? rupiah : rupiah ? "Rp. " + rupiah : "";
                        }
                        function clearTitik(huruf) {
                            return huruf.replace(/[^0-9]/g, "")
                        }
                        function clearSymbol(huruf) {
                            return huruf.replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/gi, '')
                        }
                        let total = 0
                        let totaldisc = 0
                        let pajak = 0
                        this.$data.tbl.map((v, k) => {
                            total += parseFloat(clearTitik(v.jumlah))
                            totaldisc += parseFloat(clearSymbol(clearTitik(v.diskon)))
                            pajak += parseFloat(clearSymbol(clearTitik(v.pajak)))
                        })
                        //console.log(total, totaldisc, pajak)
                        this.$data.bawah.subtotal = formatRupiah(total)
                        this.$data.bawah.totaldisc = totaldisc + "%"
                        this.$data.bawah.pajak = pajak + "%"
                        let ttldisc = (total * totaldisc) / 100
                        let tmpttl = (total - (ttldisc + parseInt(clearTitik(this.$data.bawah.tambahdisc))))
                        let withpajak = (tmpttl * pajak) / 100
                        let grandtotal = tmpttl + withpajak
                        console.log(ttldisc, (ttldisc + clearTitik(this.$data.bawah.tambahdisc)), tmpttl, withpajak, grandtotal)
                        this.$data.bawah.totalall = formatRupiah(grandtotal)
                    }
                },
                tbl: {
                    handler: function (newValue) {
                        function formatRupiah(angka, prefix) {
                            var number_string = angka.toString().replace(/[^,\d]/g, "").toString(),
                                split = number_string.split(","),
                                sisa = split[0].length % 3,
                                rupiah = split[0].substr(0, sisa),
                                ribuan = split[0].substr(sisa).match(/\d{3}/gi);
                            if (ribuan) {
                                separator = sisa ? "." : "";
                                rupiah += separator + ribuan.join(".");
                            }

                            rupiah = split[1] != undefined ? rupiah + "," + split[1] : rupiah;
                            return prefix == undefined ? rupiah : rupiah ? "Rp. " + rupiah : "";
                        }
                        function clearTitik(huruf) {
                            return huruf.replace(/[^0-9]/g, "")
                        }
                        function clearSymbol(huruf) {
                            return huruf.replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/gi, '')
                        }
                        const index = newValue.findIndex((v, i) => {
                            this.$data.tbl[i].harga = formatRupiah(this.$data.tbl[i].harga)
                            this.$data.tbl[i].kuantitas = formatRupiah(this.$data.tbl[i].kuantitas)
                            this.$data.tbl[i].diskon = clearSymbol(this.$data.tbl[i].diskon) + "%"
                            this.$data.tbl[i].pajak = clearSymbol(this.$data.tbl[i].pajak) + "%"
                            this.$data.tbl[i].jumlah = formatRupiah(clearTitik(this.$data.tbl[i].harga) * clearTitik(this.$data.tbl[i].kuantitas))

                            let total = 0
                            let totaldisc = 0
                            let pajak = 0
                            this.$data.tbl.map((v, k) => {
                                total += parseFloat(clearTitik(v.jumlah))
                                totaldisc += parseFloat(clearSymbol(clearTitik(v.diskon)))
                                pajak += parseFloat(clearSymbol(clearTitik(v.pajak)))
                            })
                            //console.log(total, totaldisc, pajak)
                            this.$data.bawah.subtotal = formatRupiah(total)
                            this.$data.bawah.totaldisc = totaldisc + "%"
                            this.$data.bawah.pajak = pajak + "%"
                            let ttldisc = (total * totaldisc) / 100
                            let tmpttl = (total - (ttldisc + parseInt(clearTitik(this.$data.bawah.tambahdisc))))
                            let withpajak = (tmpttl * pajak) / 100
                            let grandtotal = tmpttl + withpajak
                            //console.log(ttldisc, (ttldisc + clearTitik(this.$data.bawah.tambahdisc)), tmpttl, withpajak, grandtotal)
                            this.$data.bawah.totalall = formatRupiah(grandtotal)
                        })
                        //console.log(index)
                    },
                    deep: true
                }
                //tbl: function (apa, apa2) {
                //    const index = apa.findIndex(function (v, i) {
                //        return i
                //    })
                //    //console.log(apa, apa2, index)
                //    this.totalTbl()
                //}
                //tbl: {
                //    handler: (val, oldVal) => {
                //        const index = val.findIndex(function (v, i) {
                //            return i
                //        })
                //        //console.log(this.tbl[index])
                //        console.log(this)
                //        //this.tbl[index].jumlah = '10'
                //
                //    },
                //    deep: true
                //}
            },
            methods: {
                openModalInfo() {
                    $("#modalnya2").modal("show")
                },
                openModalUpload() {
                    let url = new URL(window.location.href)
                    let key = url.searchParams.get("key");
                    $("#modalnya").modal("show")
                },
                selectMitra(evt) {
                    let idx = this.findById(evt.target.value, "uuid")
                    let jsn = this.cbmitra[idx]
                    this.dtmitra.uuid = jsn["uuid"]
                    this.dtmitra.name = jsn["name"]
                    this.dtmitra.address1 = jsn["address1"]
                    this.dtmitra.address2 = jsn["address2"]
                    this.dtmitra.email = jsn["email"]
                    this.dtmitra.city = jsn["city"]
                    this.dtmitra.state = jsn["state"]
                    this.dtmitra.country = jsn["country"]
                    this.dtmitra.phone = jsn["phone"]
                    this.dtmitra.postal_code = jsn["postal_code"]

                },
                hapusrow(k) {
                    this.tbl.splice(k, 1)
                },
                addrowtbl() {
                    this.tbl.push({
                        "produk": '',
                        "deskripsi": '',
                        "kuantitas": '0',
                        "harga": '0',
                        "diskon": '0',
                        "pajak": '0',
                        "jumlah": '0',
                    })
                },
                openmodal() {

                },
                findById(tmpid, apa) {
                    let idxToRemove
                    this.cbmitra.forEach(function (dt, index) {
                        if (dt[apa] == tmpid) idxToRemove = index;
                    });
                    return idxToRemove
                },
            }
        })
    </script>
</body>

</html>